!function(m){var e=0,h=function(){return(new Date).getTime()+e++},_=function(e){return"["+e+"]$1"},w=function(e){return"_"+e+"_$1"},y=function(e,t,n){return e?"function"==typeof e?(t&&console.warn("association-insertion-traversal is ignored, because association-insertion-node is given as a function."),e(n)):"string"==typeof e?t?n[t](e):"this"==e?n:m(e):void 0:n.parent()};m(document).on("click",".add_fields",function(e){e.preventDefault();var t=m(this),n=t.data("association"),a=t.data("associations"),o=t.data("association-insertion-template"),i=t.data("association-insertion-method")||t.data("association-insertion-position")||"before",r=t.data("association-insertion-node"),s=t.data("association-insertion-traversal"),c=parseInt(t.data("count"),10),d=new RegExp("\\[new_"+n+"\\](.*?\\s)","g"),u=new RegExp("_new_"+n+"_(\\w*)","g"),l=h(),f=o.replace(d,_(l)),p=[],v=e;for(f==o&&(d=new RegExp("\\[new_"+a+"\\](.*?\\s)","g"),u=new RegExp("_new_"+a+"_(\\w*)","g"),f=o.replace(d,_(l))),p=[f=f.replace(u,w(l))],c=isNaN(c)?1:Math.max(c,1),c-=1;c;)l=h(),f=(f=o.replace(d,_(l))).replace(u,w(l)),p.push(f),c-=1;var g=y(r,s,t);g&&0!=g.length||console.warn("Couldn't find the element to insert the template. Make sure your `data-association-insertion-*` on `link_to_add_association` is correct."),m.each(p,function(e,t){var n=m(t),a=jQuery.Event("cocoon:before-insert");if(g.trigger(a,[n,v]),!a.isDefaultPrevented()){g[i](n);g.trigger("cocoon:after-insert",[n,v])}})}),m(document).on("click",".remove_fields.dynamic, .remove_fields.existing",function(e){var t=m(this),n=t.data("wrapper-class")||"nested-fields",a=t.closest("."+n),o=a.parent(),i=e;e.preventDefault(),e.stopPropagation();var r=jQuery.Event("cocoon:before-remove");if(o.trigger(r,[a,i]),!r.isDefaultPrevented()){var s=o.data("remove-timeout")||0;setTimeout(function(){t.hasClass("dynamic")?a.detach():(t.prev("input[type=hidden]").val("1"),a.hide()),o.trigger("cocoon:after-remove",[a,i])},s)}}),m(document).on("ready page:load turbolinks:load",function(){m(".remove_fields.existing.destroyed").each(function(){var e=m(this),t=e.data("wrapper-class")||"nested-fields";e.closest("."+t).hide()})})}(jQuery);